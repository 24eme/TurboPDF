{% load static %}
<!DOCTYPE html>
<html>
    <head>
        <title>TurboPDF</title>

        <link rel="shortcut icon" type="image/png" href="{% static 'images/favicon.ico' %}">
        <link rel="stylesheet" href="{%static 'css/style.css' %}">
        <link rel="stylesheet" href="{%static 'css/bootstrap.min.css' %}">

        <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"
                integrity="sha512-z8IYLHO8bTgFqj+yrPyIJnzBDf7DDhWwiEsk4sY+Oe6J2M+WQequeGS7qioI5vT6rXgVRb4K1UVQC5ER7MKzKQ=="
                crossorigin="anonymous" referrerpolicy="no-referrer">
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"
                integrity="sha512-csNcFYJniKjJxRWRV1R7fvnXrycHP6qDR21mgz1ZP55xY5d+aHLfo9/FcGDQLfn2IfngbAHd8LdfsagcCqgTcQ=="
                crossorigin="anonymous" referrerpolicy="no-referrer">
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    </head>
    <body>

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container">
                <a class="navbar-brand" href="/">TurboPDF</a>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="/appendPdf">Joindre</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/compressPdf/">Compresser</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/fillFormPdf/">Remplir un formulaire</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/addImage/">Ajouter une image</a>
        
                        </li>
                        <li>
                            <a class="nav-link" href="/lockPdf/">Verrouiller</a>
                        </li>
                        <li>
                            <a class="nav-link" href="/unlockPdf/">
                                Deverrouiller
                            </a>
                        </li>
                        <li>
                            <a class="nav-link" href="/deletePagePdf/">
                                Supprimer
                            </a>
                        </li>
                        <li>
                            <a class="nav-link" href="/splitPdf/">
                                Extraire
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div id="app">
            <h2>Assembler des PDF</h2>
            <p>Combiner deux ou plusieurs fichiers PDF.
                Cliquez sur les bouton ci-dessous pour charger vos fichiers.
            </p>

            <form enctype="multipart/form-data" id="upload-compare-pdf" method="post">
                {% csrf_token %}
                <input type="file" name="pdf-upload1" id="pdf-upload1" accept=".pdf"><br/><br />
                <input type="file" name="pdf-upload2" id="pdf-upload2" accept=".pdf"><br /><br />
                <button type="submit" id="save-button">Joindre les fichiers</button>
            </form>
            {% if download_status %}
                <p>Votre fichier a été joint avec succes et il est pret à etre téléchargé!</p> <br/>
                <div>
                    <a href="{% url 'download_append_file' %}">Télécharger le fichier joint</a>
                </div>
            {% endif %}
        </div>

        <div id="container-wrapper" style="width: 100%;">
            <div id="pdf-container1"></div>
            <div id="pdf-container2"></div>
        </div>

        <style>
            #container-wrapper {
                display: flex;
                justify-content: space-between;
            }

            #pdf-container1 {
                margin-top:2%;
                margin-right: 1%;
                flex:1;
            }
            #pdf-container2 {
                margin-top:2%;
                flex:1;
            }


        </style>

    <script>

        let pdfDoc;
        document.getElementById('pdf-upload1').addEventListener('change', function (e) {
            e.preventDefault();
            var fileInput = document.getElementById('pdf-upload1');
            var file = fileInput.files[0];

            if (file && file.type === 'application/pdf') {
                console.log(file)
                var fileReader = new FileReader();
                fileReader.onload = async function () {
                    const typedarray = new Uint8Array(this.result);
                    pdfDoc = await PDFLib.PDFDocument.load(typedarray);

                    const pdfViewer = document.getElementById('pdf-container1');
                    pdfViewer.innerHTML = '<embed src="' + URL.createObjectURL(file) + '" type="application/pdf" width="100%" height="800px" />';
                };
            }
            fileReader.readAsArrayBuffer(file);
        });

        document.getElementById('pdf-upload2').addEventListener('change', function (e) {
            e.preventDefault();
            var fileInput = document.getElementById('pdf-upload2');
            var file = fileInput.files[0];

            if (file && file.type === 'application/pdf') {
                console.log(file)
                var fileReader = new FileReader();
                fileReader.onload = async function () {
                    const typedarray = new Uint8Array(this.result);
                    pdfDoc = await PDFLib.PDFDocument.load(typedarray);

                    const pdfViewer = document.getElementById('pdf-container2');
                    pdfViewer.innerHTML = '<embed src="' + URL.createObjectURL(file) + '" type="application/pdf" width="100%" height="800px" />';
                };
            }
            fileReader.readAsArrayBuffer(file);
        });
    </script>
    </body>
</html>